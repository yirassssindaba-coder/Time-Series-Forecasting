<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>{{ title }}</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600&display=swap" rel="stylesheet">
  <style>
    :root{
      --bg:#f5f7fb;
      --card:#ffffff;
      --muted:#667085;
      --accent:#0b5ed7;
      --border:#e6e9ef;
      --success:#16a34a;
      --danger:#e11d48;
    }
    html,body{height:100%;margin:0;background:var(--bg);font-family:Inter, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;}
    .container{max-width:1100px;margin:28px auto;padding:20px;}
    .header{display:flex;align-items:center;justify-content:space-between;gap:16px}
    .brand{display:flex;align-items:center;gap:12px}
    .logo{width:56px;height:56px;border-radius:10px;background:linear-gradient(135deg,#0b5ed7,#6ea8fe);display:flex;align-items:center;justify-content:center;color:#fff;font-weight:700;font-size:20px}
    h1{margin:0;font-size:1.4rem;color:#0b2545}
    p.meta{margin:0;color:var(--muted);font-size:0.95rem}
    .grid{display:grid;grid-template-columns:1fr 360px;gap:18px;margin-top:18px}
    .card{background:var(--card);border:1px solid var(--border);padding:16px;border-radius:10px;box-shadow:0 4px 12px rgba(11,37,69,0.04)}
    .metrics{display:flex;gap:10px;flex-wrap:wrap}
    .metric{background:#fbfdff;border:1px solid #eef4ff;padding:10px;border-radius:8px;min-width:140px}
    .metric strong{display:block;font-size:0.95rem;color:#0b2545}
    .metric span{color:var(--muted);font-size:0.85rem}
    .chart-wrap{min-height:420px}
    .section-title{margin:0 0 8px 0;color:#0b2545;font-size:1rem}
    table.metrics-table{width:100%;border-collapse:collapse;margin-top:12px}
    table.metrics-table th, table.metrics-table td{padding:8px 10px;border:1px solid #eef2f7;text-align:left;font-size:0.9rem}
    .explain{color:var(--muted);line-height:1.5}
    .footer{margin-top:20px;color:var(--muted);font-size:0.9rem}
    @media (max-width:900px){.grid{grid-template-columns:1fr;}}
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <div class="brand">
        <div class="logo">TS</div>
        <div>
          <h1>{{ title }}</h1>
          <p class="meta">Generated: {{ run_info.timestamp }} · Ticker: <strong>{{ run_info.ticker }}</strong> · Model: <strong>{{ run_info.model_used }}</strong></p>
        </div>
      </div>
      <div>
        <a href="#" onclick="window.print()" style="display:inline-block;padding:8px 12px;background:var(--accent);color:#fff;border-radius:8px;text-decoration:none;font-weight:600">Print</a>
      </div>
    </div>

    <div class="grid">
      <div>
        <div class="card">
          <h3 class="section-title">Interactive chart</h3>
          <div class="chart-wrap">
            {{ fig_html | safe }}
          </div>
        </div>

        <div class="card" style="margin-top:12px">
          <h3 class="section-title">Backtest metrics</h3>
          {% if metrics_html %}
            <div>{{ metrics_html | safe }}</div>
          {% else %}
            <div class="explain">No backtest windows were available or backtest was skipped. Use the notebook to run a rolling-origin backtest.</div>
          {% endif %}
        </div>

        <div class="card" style="margin-top:12px">
          <h3 class="section-title">Detailed forecast & recent values</h3>
          <div class="explain">
            Below are the latest actual values and the generated forecasted values for the next {{ run_info.horizon }} days. Use CSV files in the results folder for full data.
          </div>
          <div style="margin-top:10px">
            <!-- Optional embedded table from notebook can be placed here -->
          </div>
        </div>
      </div>

      <aside>
        <div class="card">
          <h3 class="section-title">Summary</h3>
          <div class="metrics" style="margin-top:10px">
            <div class="metric"><strong>Ticker</strong><span>{{ run_info.ticker }}</span></div>
            <div class="metric"><strong>Model</strong><span>{{ run_info.model_used }}</span></div>
            <div class="metric"><strong>Horizon</strong><span>{{ run_info.horizon }} days</span></div>
            <div class="metric"><strong>Timestamp</strong><span>{{ run_info.timestamp }}</span></div>
          </div>
        </div>

        <div class="card" style="margin-top:12px">
          <h3 class="section-title">Interpretation & notes</h3>
          <p class="explain">
            {{ explanation }}
          </p>
          <ul class="explain">
            <li>Black line = historical actual values (resampled to daily).</li>
            <li>Red line = iterative forecast for the next {{ run_info.horizon }} days.</li>
            <li>Metrics (MAE / RMSE) evaluate forecast quality per backtest window when available.</li>
          </ul>
        </div>

        <div class="card" style="margin-top:12px">
          <h3 class="section-title">Files</h3>
          <div class="explain">
            Raw CSV: <code>data/raw/{{ run_info.ticker }}.csv</code><br/>
            Processed CSV: <code>data/processed/{{ run_info.ticker }}_parsed.csv</code><br/>
            Forecast CSV: <code>results/{{ run_info.ticker }}_forecast_{{ run_info.timestamp }}.csv</code><br/>
            HTML report: <code>results/notebooks_html/report_{{ run_info.ticker }}_{{ run_info.timestamp }}.html</code>
          </div>
        </div>
      </aside>
    </div>

    <div class="footer">Generated by pipeline_run.py — open the notebook for step-by-step reproducibility.</div>
  </div>
</body>
</html>
